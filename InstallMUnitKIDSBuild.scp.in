;---------------------------------------------------------------------------
; Copyright 2011-2012 The Open Source Electronic Health Record Agent
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
;     http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS,
; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
; See the License for the specific language governing permissions and
; limitations under the License.
;---------------------------------------------------------------------------
;initialization -- turn match off to make comparisons more lenient
case match: off
debug: off

;set the title
title: VistA Munit KIDS Build Installation Script
logfile:<P1>

on error: $Exit
; set up a timer for 10 minutes (10*60*10), should be more than enough to finish
timer: 6000

wait for:>
;switch to the right namespace
send: znspace "${NAMESPACE}"<CR>
wait for:${NAMESPACE}>
;---------------------------------------------------------------------
;- SECTION TO INSTALL MUNIT KIDS BUILD
;---------------------------------------------------------------------
send:S DUZ=1 D ^XUP<CR>
wait for:Select OPTION NAME:
send:EVE<CR>
wait for:CHOOSE 1-
send:1<CR>
wait for:Select Systems Manager Menu Option:
send:Programmer Options<CR>
wait for:Select Programmer Options Option:
send:KIDS<CR>
wait for:Select Kernel Installation & Distribution System Option:
send:Installation<CR>
wait for:Select Installation Option:
send:1<CR>
wait for:Enter a Host File:
send:${MUNIT_KIDS_FILE}<CR>
subroutine: $TryWait
  ;return from subroutine
wait for:Select Installation Option:
send: Install Package<CR>
wait for:Select INSTALL NAME:
send:${MUNIT_PACKAGE_INSTALL_NAME}<CR>
wait for:Want KIDS to Rebuild Menu Trees Upon Completion of Install?
send:NO<CR>
wait for:Want KIDS to INHIBIT LOGONs during the install?
send:NO<CR>
wait for:Want to DISABLE Scheduled Options, Menu Options, and Protocols?
send:NO<CR>
wait for:DEVICE:
send:HOME;82;999<CR>
wait for:Select Installation Option:
send:<CR>
wait for:Select Kernel Installation & Distribution System Option:
send:<CR>
wait for:Select Programmer Options Option:
send:<CR>
wait for:Select Systems Manager Menu Option:
send:^<CR>
wait for:${NAMESPACE}>
$Exit:
    timer: 0
; close the log file
    closelog
; exit the terminal
    terminate

$TryWait:
  on error: $Ignore
  timer: 120
  ;got TryWait
  multiwait for: =OK to continue with Load?=Want to Continue with Load?=Select Installation Option:
  ;got result, match is not official documented, found from Cache Group
  match:Select Installation Option:
  ;check match
  if true: $Ignore
  ;not match check another match
  match:Want to Continue with Load?
  if true: $YesGO
  ;not match send Yes first
  send:YES<CR>
  wait for: Want to Continue with Load?
  ;got it and send Yes
  send:YES<CR>
  timer: 0
  return

$Ignore:
  ;got Time out
  send:YES<CR>
  timer: 0
  return

$YesGO:
  ;send yes and go
  timer: 0
  send:YES<CR>
  return
